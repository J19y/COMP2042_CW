<?xml version="1.0" encoding="UTF-8"?>

<?import com.comp2042.tetris.ui.view.GameOverPanel?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Slider?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.Group?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import java.net.URL?>

<StackPane fx:id="rootPane" fx:controller="com.comp2042.tetris.ui.view.GuiController"
           xmlns:fx="http://javafx.com/fxml"
           prefWidth="700" prefHeight="600"
           styleClass="root">
    
    <!-- Background Animation Layer -->
    <Pane fx:id="backgroundPane" />

    <HBox alignment="CENTER" spacing="20">
        <!-- Left Column: Stats -->
        <VBox alignment="TOP_CENTER" spacing="20" style="-fx-padding: 50 0 0 0;">
            <!-- Info Panel (Timer & Score) -->
            <VBox spacing="15" styleClass="info-panel" minWidth="120" maxWidth="120" alignment="CENTER_LEFT">
                    <VBox spacing="8" alignment="CENTER_LEFT">
                        <Text text="TIMER:" styleClass="info-label"/>
                        <Text fx:id="timerText" text="00:00" styleClass="info-value-timer"/>
                    </VBox>
                    <VBox spacing="8" alignment="CENTER_LEFT" style="-fx-padding: 12 0 0 0;">
                        <Text text="SCORE:" styleClass="info-label"/>
                        <Text fx:id="scoreText" text="0" styleClass="info-value-score"/>
                    </VBox>
            </VBox>
            
            <!-- Pause Button (on-screen) -->
            <Button fx:id="pauseButton" text="â¸" styleClass="menu-button" onAction="#pauseGame"
                    style="-fx-font-size: 20px; -fx-min-width: 50px; -fx-min-height: 50px;">
                <tooltip>
                    <Tooltip text="Pause (P)" />
                </tooltip>
            </Button>
        </VBox>

        <!-- Center Column: Game Board -->
        <BorderPane fx:id="gameBoard" styleClass="gameBoard"
                   prefWidth="215" prefHeight="425"
                   minWidth="215" minHeight="425"
                   maxWidth="215" maxHeight="425">
            <center>
                <StackPane>
                    <Pane fx:id="boardClipContainer" maxWidth="209" maxHeight="419" minWidth="209" minHeight="419" prefWidth="209" prefHeight="419">
                        <GridPane fx:id="gamePanel" hgap="1" vgap="1"
                                  prefWidth="209" prefHeight="419"
                                  minWidth="209" minHeight="419"
                                  maxWidth="209" maxHeight="419"/>
                        <GridPane fx:id="ghostPanel" hgap="1" vgap="1"
                                  prefWidth="209" prefHeight="419"
                                  minWidth="209" minHeight="419"
                                  maxWidth="209" maxHeight="419"
                                  mouseTransparent="true" managed="false"/>
                        <GridPane fx:id="brickPanel" hgap="1" vgap="1" mouseTransparent="true" managed="false"/>
                    </Pane>
                    
                    <!-- Countdown Overlay -->
                    <StackPane fx:id="countdownOverlay" visible="false">
                        <Text fx:id="countdownText" text="3" styleClass="countdown-text"/>
                    </StackPane>
                </StackPane>
            </center>
        </BorderPane>

        <!-- Right Column: NEXT -->
        <VBox alignment="TOP_CENTER" spacing="20" style="-fx-padding: 50 0 0 0;">
            <VBox spacing="5" alignment="CENTER_LEFT">
                <Text text="NEXT" styleClass="panel-label"/>
                <StackPane styleClass="next-panel" minWidth="100" minHeight="300" maxWidth="100" maxHeight="300" alignment="TOP_CENTER">
                    <VBox fx:id="nextBrickPanel" spacing="20" alignment="CENTER" style="-fx-padding: 20 0 0 0;"/>
                </StackPane>
            </VBox>
        </VBox>
    </HBox>

    <Pane fx:id="pauseDim" styleClass="pause-dim" visible="false" mouseTransparent="true" />

    <!-- Notification Overlay -->
    <Group fx:id="groupNotification">
        <StackPane alignment="CENTER">
            <GameOverPanel fx:id="gameOverPanel"/>
        </StackPane>
    </Group>
    
    <!-- Settings Overlay -->
    <StackPane fx:id="settingsOverlay" visible="false" style="-fx-background-color: rgba(0,0,0,0.8);">
        <VBox spacing="18" alignment="CENTER" styleClass="info-panel" maxWidth="320" maxHeight="320">
            <Text text="PAUSED" styleClass="panel-label" style="-fx-font-size: 26px;"/>

            <Button fx:id="resumeButton" text="RESUME" styleClass="menu-button" onAction="#resumeGame" prefWidth="200">
                <graphic>
                    <Text text="â–¶" fill="#ffffff" />
                </graphic>
            </Button>

            <HBox spacing="10" alignment="CENTER" styleClass="music-controls">
                <Slider fx:id="volumeSlider" min="0" max="100" value="100" prefWidth="140" />
                <Button fx:id="musicToggleButton" text="ON" styleClass="menu-button small-button" onAction="#toggleMusic" prefWidth="64"
                        style="-fx-background-color: transparent; -fx-border-color: rgba(0,255,220,0.12); -fx-border-width: 1px; -fx-background-radius: 10px; -fx-border-radius: 10px; -fx-text-fill: #eaf6ff;">
                    <graphic>
                        <Text text="ðŸ”Š" fill="#ffffff" />
                    </graphic>
                    <tooltip>
                        <Tooltip text="Toggle music (P)" />
                    </tooltip>
                </Button>
                <Text fx:id="volumeText" text="100%" styleClass="info-label"/>
            </HBox>

            <Pane prefHeight="1" prefWidth="200" styleClass="settings-separator" />

            <Button text="MAIN MENU" styleClass="menu-button" onAction="#returnToMenu" prefWidth="200">
                <graphic>
                    <Text text="â" fill="#ffffff" />
                </graphic>
            </Button>
        </VBox>
    </StackPane>

    <stylesheets>
        <URL value="@../styles/window.css"/>
    </stylesheets>
</StackPane>

